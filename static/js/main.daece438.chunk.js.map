{"version":3,"sources":["../node_modules/pdfjs-dist/build sync","App.js","serviceWorker.js","index.js","logo.svg"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","PdfJsLib","GlobalWorkerOptions","workerSrc","PROXY","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","zips","status","progress","maxDownloadFiles","input","React","createRef","addTextToZip","bind","assertThisInitialized","downloadZip","handleTryOnClick","handleDownloadOnClick","url","current","value","collection","feed","_this2","_URLParse","URLParse","hostname","path","includes","setState","defineProperty","slice","concat","indexOf","replace","fetch","method","then","response","json","jsonFeed","docs","flatMap","doc","url_fulltext","manifests","forEach","manifest","retrieveManifest","label","generateAsync","type","blob","saveAs","err","console","log","filename","texts","_this3","objectSpread","JSZip","Promise","all","map","promise","catch","textChunks","text","chunk","join","file","manifestUri","uri","_this4","Manifesto","create","getSequences","seq","getRenderings","rendering","options","resource","__jsonld","flat","pdfFiles","pdfFile","pdfDoc","getDocument","onProgress","_ref2","loaded","total","size","Math","pow","toFixed","fileSize","pdf","toConsumableArray","Array","_pdfInfo","numPages","pageNumber","getPage","pdfPage","getTextContent","textContent","items","str","files","length","getCanvases","canvas","getCanonicalImageUri","imageFiles","imageFile","resizedImageFileURI","_ref","arguments","undefined","_ref$region","region","_ref$size","_ref$rotation","rotation","_ref$quality","quality","baseUri","split","transformIIIFImage","Tesseract","recognize","_ref3","parseInt","result","_this5","react_default","a","createElement","min","max","item","idx","key","href","downloads","zip","onClick","className","src","logo","alt","title","ref","placeholder","Component","Boolean","window","location","match","ReactDOM","render","src_App_0","document","getElementById","navigator","serviceWorker","ready","registration","unregister","__webpack_require__","p"],"mappings":"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","file":"static/js/main.daece438.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 18;","import { parse as URLParse } from 'url';\nimport React, { Component } from 'react';\n\nimport Tesseract from 'tesseract.js'\nimport PdfJsLib from 'pdfjs-dist';\nimport JSZip from 'jszip';\nimport saveAs from 'file-saver';\n\nimport flat from 'array.prototype.flat';\nimport Manifesto from 'manifesto.js';\n\nimport logo from './logo.svg';\nimport './App.css';\n\nPdfJsLib.GlobalWorkerOptions.workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.943/pdf.worker.js';\n\nconst PROXY = 'https://cors-anywhere-vanfexfhcx.now.sh/';\n\nconst getPDFsFromIIIFManifest = uri => fetch(`${PROXY}${uri}`, { method: 'GET' })\n  .then(response => response.json())\n  .then(manifest => Manifesto\n    .create(manifest)\n    .getSequences()\n    .map(seq => seq\n      .getRenderings()\n      .map(rendering => ({\n        label: rendering.options.resource.__jsonld.label,\n        uri: rendering.id\n      }))\n    )\n  ).then(flat);\n\nconst getImagesFromIIIFManifest = uri => fetch(`${PROXY}${uri}`, { method: 'GET' })\n  .then(response => response.json())\n  .then(manifest => Manifesto\n    .create(manifest)\n    .getSequences()\n    .map(seq => seq\n      .getCanvases()\n      .map(canvas => ({\n        label: canvas.__jsonld.label,\n        uri: canvas.getCanonicalImageUri()\n      }))\n    )\n  ).then(flat);\n\n// http://host:port/iiif/2/filename.ext/full/500,/10/default.jpg\nconst transformIIIFImage = (uri, { region = \"full\", size = \"max\", rotation = 0, quality = \"default\" } = {}) => {\n  const baseUri = uri.split('/').slice(0, -4).join('/')\n  return `${baseUri}/${region}/${size}/${rotation}/${quality}.jpg`;\n}\n\nconst fileSize = size => {\n  const e = (Math.log(size) / Math.log(1e3)) | 0;\n  return +(size / Math.pow(1e3, e)).toFixed(2) + ' ' + ('kMGTPEZY'[e - 1] || '') + 'B';\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      zips: {},\n      status: {},\n      progress: null\n    }\n    this.maxDownloadFiles = 10;  // max is limited to 100 by searchworks\n    this.input = React.createRef();\n    this.addTextToZip = this.addTextToZip.bind(this);\n    this.downloadZip = this.downloadZip.bind(this);\n    this.handleTryOnClick = this.handleTryOnClick.bind(this);\n    this.handleDownloadOnClick = this.handleDownloadOnClick.bind(this);\n  }\n\n  handleTryOnClick(url) {\n    this.input.current.value = url;\n  }\n\n  handleDownloadOnClick() {\n    const url = this.input.current.value;\n    const { hostname, path } = URLParse(url);\n    if (['purl.stanford.edu', 'searchworks.stanford.edu'].includes(hostname)) {\n      this.setState({progress: 0, status: {[[url]]: \"Downloading collection...\"}});\n      let collection;\n      let feed;\n      if (hostname === 'purl.stanford.edu') {\n        collection = path.slice(1);\n        feed = `https://searchworks.stanford.edu/catalog.json?f%5Bcollection%5D%5B%5D=${collection}&per_page=${this.maxDownloadFiles}`;\n      } else if (url.indexOf(\"searchworks.stanford.edu/catalog.atom\") >= 0) {\n        collection = url.replace(\"catalog.atom\", \"catalog.json\");\n        feed = `${collection}&per_page=${this.maxDownloadFiles}`;\n      } else if (url.indexOf('searchworks.stanford.edu/catalog?') >= 0) {\n        collection = url.replace('catalog?', 'catalog.json?');\n        feed = `${collection}&per_page=${this.maxDownloadFiles}`;\n      }\n      fetch(`${PROXY}${feed}`, { method: 'GET' })\n        .then(response => {\n          this.setState({progress: 0});\n          return response.json();\n        })\n        .then(jsonFeed => {\n          return jsonFeed.response.docs.flatMap(doc => `${doc.url_fulltext}/iiif/manifest`);\n        })\n        .then(manifests => {\n          this.setState({status: {[[url]]: \"Downloading contents...\"}});\n          manifests.forEach(manifest => {\n            this.retrieveManifest(collection, manifest);\n          })\n        });\n      this.input.current.value = \"\";\n    }\n  }\n\n  downloadZip(label) {\n    this.state.zips[label].generateAsync({type: 'blob'}).then(function (blob) {\n        saveAs(blob, `${label}.zip`);\n    }, function (err) {\n        console.log(err);\n    });\n  }\n\n  addTextToZip(label, filename, texts) {\n    this.setState({\n      zips: {[[label]]: new JSZip(), ...this.state.zips},\n      status: {...this.state.status, [[filename]]: \"Extracting text...\"}\n    });\n    Promise.all(texts.map(promise => promise.catch(err => err)))\n    .then(textChunks => {\n      const text = textChunks.map(chunk => chunk.text || chunk).join(' ');\n      this.setState({\n        progress: this.state.progress + 1\n      });\n      this.state.zips[label].file(`${filename}.txt`, text);\n      this.setState({\n        status: {...this.state.status, [[filename]]: \"Done\"}\n      });\n      if (this.state.progress === this.maxDownloadFiles) {\n        this.downloadZip(label);\n        this.setState({\n          progress: null,\n          status: {},\n        })\n      }\n    })\n    .then(() => {\n      this.setState({\n        status: {...this.state.status, [[filename]]: \"Adding to zip...\"}\n      })\n    })\n    .catch(err => console.log(err));\n  }\n\n  retrieveManifest(label, manifestUri) {\n    getPDFsFromIIIFManifest(manifestUri).then(pdfFiles => {\n      return pdfFiles.map(pdfFile => {\n        const pdfDoc = PdfJsLib.getDocument(`${PROXY}${pdfFile.uri}`)\n        pdfDoc.onProgress = ({loaded, total}) => {\n          this.setState({status: {...this.state.status, [[pdfFile.label]]: fileSize(loaded)}})\n        }\n        return pdfDoc.then((pdf) => {\n          const texts = [...Array(pdf._pdfInfo.numPages).keys()].map(pageNumber => {\n            this.setState({status: {...this.state.status, [[pdfFile.label]]: `Extractig page ${pageNumber + 1}`}})\n            return pdf.getPage(pageNumber + 1).then(pdfPage => (\n              pdfPage.getTextContent().then(textContent => (\n                textContent.items.map(text => text.str).join(' ')\n              ))\n            ))\n          });\n          this.addTextToZip(label, pdfFile.label, texts);\n        });\n      })\n    }).then(files => {\n      if (files.length === 0) {\n        this.setState({status: {...this.state.status, [[manifestUri]]: \"No PDFs found. Searching images...\"}});\n        getImagesFromIIIFManifest(manifestUri).then(imageFiles => {\n          return imageFiles.map(imageFile => {\n            const resizedImageFileURI = transformIIIFImage(imageFile.uri, { size: \"512,\" });\n            return Tesseract.recognize(resizedImageFileURI)\n              .progress(({status, progress}) => this.setState({\n                status: {...this.state.status, [[manifestUri]]: `${status} (${imageFile.label}) ${parseInt(progress * 100)}%`}\n              }))\n              .then(result => result.text)\n          })\n        }).then(texts => {\n          this.addTextToZip(label, manifestUri, texts);\n        })\n      }\n    })\n  }\n\n  render() {\n    const progress = (this.state.progress !== null && this.state.progress !== this.maxDownloadFiles) ? (\n      <progress min={0} max={this.maxDownloadFiles} value={this.state.progress} />\n    ) : ('');\n    const status = Object.keys(\n      this.state.status\n    ).map((item, idx) => (\n      [(!idx ? <dt key={`dt${idx}`}><a href={item}>{item}</a></dt> : <dt key={`dt${idx}`}>{item}</dt>), <dd key={`dd${idx}`}>{this.state.status[item]}</dd>]\n    ));\n    const downloads = Object.keys(this.state.zips).map((zip, idx) => (\n      <li key=\"li{idx}\">Download <button href=\"#\" onClick={() => this.downloadZip(zip)}>{zip}.zip</button></li>\n    ));\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            To download the available plain texts of a IIIF catalog collection containing PDF or <acronym title=\"Images will be OCR'ed in the browser using Tesseract (defaults to English)\">image</acronym> files,\n            <br />\n            enter its URL and click on Download\n            (only the first <acronym title=\"This is only a proof of concept\">~{this.maxDownloadFiles} items</acronym> will be retrieved)\n          </p>\n          <p>\n            <input type=\"text\" ref={this.input} placeholder=\"https://purl.stanford.edu/jt466yc7169\" />\n            <input type=\"submit\" onClick={this.handleDownloadOnClick} value=\"Download\" />\n            <br />\n            <small>\n              Try the <button href=\"#\" onClick={() => this.handleTryOnClick(\"https://purl.stanford.edu/jt466yc7169\")}>\n                Jarndyce Single-Volume Nineteenth-Century Novel Collection, 1823-1914\n              </button>,<br />\n              or the <button href=\"#\" onClick={() => this.handleTryOnClick(\"https://searchworks.stanford.edu/catalog?f%5Bcollection%5D%5B%5D=12358426\")}>\n                Racism Lives Here Too Movement records, 2018\n              </button>.\n            </small>\n          </p>\n          <div className=\"App-log\">\n            {progress}\n            <dl>\n              {status}\n            </dl>\n            <ul>\n              {downloads}\n            </ul>\n          </div>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/logo.1e0f9ac8.svg\";"],"sourceRoot":""}